<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>調査結果</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    canvas { max-width: 1000px; margin-bottom: 40px; }
  </style>
</head>
<body>
  <h1>調査結果</h1>
  <h2>学園の課題に関する集計</h2>
  <canvas id="issuesChart"></canvas>

  <h2>候補者支持の集計</h2>
  <canvas id="candidatesChart"></canvas>

  <script>
    const scriptUrl = '<<https://script.google.com/macros/s/AKfycbyBTe2myB78boUWg9VBjzrYERW-ADSqqPSvptmKq8BA9s4X_nT4NBtAaTpZuJRx6CPS/exec>>';

    fetch(scriptUrl)
      .then(response => response.json())
      .then(data => {
        const issuesCount = {};
        const candidatesCount = {};

        for (let i = 1; i < data.length; i++) {
          const issue = data[i][1];
          const candidate = data[i][2];

          issuesCount[issue] = (issuesCount[issue] || 0) + 1;
          candidatesCount[candidate] = (candidatesCount[candidate] || 0) + 1;
        }

        function renderChart(canvasId, counts) {
          const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
          new Chart(document.getElementById(canvasId), {
            type: 'bar',
            data: {
              labels: sorted.map(e => e[0]),
              datasets: [{
                label: '得票数',
                data: sorted.map(e => e[1]),
                backgroundColor: 'red'
              }]
            },
            options: {
              indexAxis: 'y'
            }
          });
        }

        renderChart('issuesChart', issuesCount);
        renderChart('candidatesChart', candidatesCount);
      });
  </script>
</body>
</html>
